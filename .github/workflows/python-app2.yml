name: Extract Lisbon Flight Data

on:
    schedule:
      - cron: "*/15 * * * *"
      
jobs:
    build:
        runs-on: ubuntu-latest
        container: python:3

        steps:
          - uses: actions/checkout@v2
            with:
               persist-credentials: false # otherwise, the token used is the GITHUB_TOKEN, instead of your personal access token.
               fetch-depth: 0 # otherwise, there would be errors pushing refs to the destination repository.
               ref: ${{ github.head_ref }}
               
          - name: Configure pt_PT locale
            run: |
              apt-get update -y && apt-get install -y locales && echo "pt_PT.UTF-8 UTF-8" | tee -a /etc/locale.gen && locale-gen pt_PT.UTF-8
          - name: Configure pt_PT (Europe/Lisbon) timezone
            run: |
              ln -fs /usr/share/zoneinfo/Europe/Lisbon /etc/localtime && dpkg-reconfigure --frontend noninteractive tzdata
          - name: Install dependencies
            run: |
              python -m pip install --upgrade pip
              python -m pip install -r requirements.txt
          - name: Scrap flight data
            run: |
              python get_lisbon_airport_flights.py
          - name: Commit changes
            uses: stefanzweifel/git-auto-commit-action@v4.1.1
            with:
                commit_message: Update Lisbon Flight dataa
                branch: ${{ github.head_ref }}
